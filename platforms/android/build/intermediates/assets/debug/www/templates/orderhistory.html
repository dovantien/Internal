<ion-view view-title="Order History">
  <ion-content has-bouncing="false" delegate-handle="history_list" overflow-scroll = "true">
    <button ng-if="!isMore" class="button button-block button-positive" ng-click="moreHistory(0)" style="background: red">
      Today
    </button>
    <ion-list has-bouncing="false" can-swipe="false">
      <ion-item collection-repeat="item in listHistoryOrder" class="item odh_item odh_item_status_{{item.cartstatus}}" ng-click="clickOrderHistory(item)">
        <div class="orderdetail_stt">{{$index + 1}}</div>
        <div class="row">
          <div class="col col-50 odh_cartnumb">#{{item.cart.cartnumb}}</div>
          <div class="col col-50 odh_timeorder">- {{item.products[0].prodnum}} {{item.products[0].prodname}}</div>
        </div>
        <div class="row">
          <div class="col col-50 odh_cartshop">{{item.cart.shoptablename}}</div>
          <div class="col col-50 odh_timeorder" ng-if="item.products[1]">- {{item.products[1].prodnum}} {{item.products[1].prodname}}</div>
        </div>
        <div class="row">
          <div class="col col-50 odh_status">{{(item.cart.cartstatname)}}</div>
          <div class="col col-50 odh_timeorder" ng-if="item.products[2]">- {{item.products[2].prodnum}} {{item.products[2].prodname}}</div>
        </div>
        <div class="row">
          <div class="col col-50 odh_timeorder">{{utils.formatDateView(item.cart.ordertime)}}</div>
          <div class="col col-50 odh_cartshop" ng-if="item.products[3]"> ...</div>
        </div>
      </ion-item>
    </ion-list>
    <button ng-if="isMore" class="button button-block button-positive" ng-click="moreHistory(1)" style="background: red">
      More history
    </button>
  </ion-content>
  <!-- popup detail order -->
  <div class="showPopup" style="position: absolute;height: 100%;width: 100%;background: rgba(0, 0, 0, 0.4);top:0px;" ng-if="isShowOrderDetail">
    <div style="width: 100%;height: 100%;background: transparent;position: relative;">
      <div class="orderdetail_popup" id="oderdetailModal">
        <h1 class="orderdetail_popup_title" ng-click="clickChooseTable()">{{edittingOrder.cart.shoptablename}} - #{{edittingOrder.cart.cartnumb}}</h1>
        <img class="pop_1_close2" src="img/popup/btn_close.png" ng-click="closePopup()">
        <ion-content style="height: 79%" delegate-handle="history_list" scrollbar-y="false">
          <div ng-repeat="x in edittingOrder.productsEdit track by $index" style="padding: 10px; position: relative;border-bottom: solid 1px red;" >
            <div style=" position: absolute;width: 100%;height: 100%;top: 0;left: 0;z-index: 100" ng-click="clickEditOrder(x,$index)"></div>
            <img src="{{x.prodimg}}" class="orderdetail_img" >
            <div class="orderdetail_prod_name">{{x.prodname}}</div>
            <div style="position: absolute;top: 40px;left: 125px;width: 100%">
            <div ng-repeat="item in x.option">{{item.selected.optdetailname}}</div>
            </div>
            <div class="orderdetail_btn_delete" ng-click="clickDelete(x, $index)" ng-if="utils.activeFunFromUser(user.roleid,3)">XÃ³a</div>
          </div>
        </ion-content>
        <div ng-show="utils.activeFunFromUser(user.roleid,3)">
          <input type="text" name="" placeholder="Note..." class="orderdetail_note" ng-model=edittingOrder.orderNote ng-change="isEditted=true">
        </div>
        <div class="orderdetail_btn_clear" ng-if="utils.activeFunFromUser(user.roleid,3)" ng-click="cancelOrder()">Cancel</div>
        <div class="orderdetail_btn_order" ng-click="closePopup()" ng-if="!isEditted" ng-style="!utils.activeFunFromUser(user.roleid,3)?{right:'33%'}:{}">OK</div>
        <div class="orderdetail_btn_order" ng-click="doOrder()" ng-if="isEditted">Submit</div>
      </div>
      <div  style="height: 100%;
    width: 100%;
    position: absolute;
    background: red;
    z-index: 1;
    background: transparent;"></div>
    </div>
  </div>
</ion-view>
